<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Open Court</title>

<style>
body { font-family: system-ui, Arial; background:#020617; color:white; margin:0; padding:14px; }

header {
  text-align:center;
  padding:16px 10px;
  border-radius:20px;
  margin-bottom:14px;
  background:linear-gradient(135deg,#0f172a,#020617);
  border:1px solid #1e293b;
}

header img {
  max-width:220px;
  width:80%;
  margin-bottom:6px;
}

header p {
  margin:4px 0 0;
  font-weight:700;
  opacity:.85;
}

.section {
  border:1px solid #1e293b;
  border-radius:18px;
  padding:14px;
  margin-bottom:14px;
}

h2 { text-align:center; margin:4px 0 10px; }

label { font-weight:700; display:block; margin-top:8px; opacity:.85; }

textarea,input {
  width:100%; padding:12px; border-radius:12px;
  border:none; margin-top:6px; font-size:16px;
}

button {
  width:100%; padding:14px; border:none; border-radius:14px;
  font-size:18px; font-weight:800; background:#22c55e; margin-top:10px;
}

.secondary { background:#0ea5e9; }
.gray { background:#334155; }

#roundLabel { text-align:center; font-size:28px; font-weight:900; }
#timer { text-align:center; font-size:36px; font-weight:900; margin:6px 0; }

.court {
  border:1px solid #1e293b;
  border-radius:18px;
  padding:12px;
  margin-top:12px;
}

.row { display:flex; gap:8px; margin-bottom:8px; }

.pill {
  flex:1; text-align:center; background:#0f172a;
  padding:10px 6px; border-radius:999px; font-weight:700;
}

.center { text-align:center; }
.big { font-size:22px; font-weight:800; }

#leaderboard { font-size:20px; line-height:1.7; }
.footer { text-align:center; opacity:.6; font-size:13px; margin-top:10px; }
</style>
</head>

<body>

<header>
  <img src="logo.png" alt="Open Court logo">
  <p>Open Court ‚Äî Pickleball Session Manager</p>
</header>

<div class="footer">an app by Alan‚Äôs LLC</div>

<!-- QR SIGN-IN -->
<div id="qr" class="section">
  <h2>Player Sign-In</h2>
  <p class="center">Scan the QR code and enter your name</p>
  <div class="center">
    <img id="qrImg" style="max-width:220px;border-radius:12px">
  </div>
  <input id="qrName" placeholder="Enter your name">
  <button onclick="addFromQR()">Add Me</button>
  <div id="qrList" class="center" style="margin-top:10px;font-weight:700"></div>
  <button class="secondary" onclick="goSetup()">Continue to Setup</button>
</div>

<!-- SETUP -->
<div id="setup" class="section" style="display:none">
  <h2>Session Setup</h2>

  <label>Players</label>
  <textarea id="players"></textarea>

  <label>Courts Available</label>
  <input id="courtsCount" type="number" min="1" value="2">

  <label>Minutes Per Round</label>
  <input id="roundMinutes" type="number" min="5" value="12">

  <label>Total Rounds</label>
  <input id="totalRounds" type="number" min="1" value="5">

  <button onclick="start()">Start Session</button>
</div>

<!-- GAME -->
<div id="game" style="display:none">

  <div class="section">
    <div id="roundLabel"></div>
    <div id="timer"></div>
    <div class="center big" id="roundCount"></div>
  </div>

  <div id="courts"></div>

  <button class="secondary" onclick="nextRound()">Next Round</button>
  <button class="gray" onclick="reset()">Reset Session</button>
</div>

<!-- LEADERBOARD -->
<div id="end" class="section" style="display:none">
  <h2>üèÜ Final Leaderboard</h2>
  <div id="leaderboard"></div>
  <button onclick="reset()">New Session</button>
</div>

<script>
let players=[], wins={}, round=1, totalRounds=1, timerInterval;

document.getElementById("qrImg").src =
  "https://api.qrserver.com/v1/create-qr-code/?size=250x250&data="+location.href;

function addFromQR(){
  let name = document.getElementById("qrName").value.trim();
  if(!name || players.includes(name)) return;
  players.push(name); wins[name]=0;
  document.getElementById("qrList").innerText = players.join(", ");
  document.getElementById("qrName").value="";
}

function goSetup(){
  document.getElementById("qr").style.display="none";
  document.getElementById("setup").style.display="block";
  document.getElementById("players").value = players.join("\n");
}

function start(){
  players = document.getElementById("players").value.split("\n").map(p=>p.trim()).filter(p=>p);
  players.forEach(p=>wins[p]=0);
  totalRounds = Number(document.getElementById("totalRounds").value);
  document.getElementById("setup").style.display="none";
  document.getElementById("game").style.display="block";
  buildRound();
}

function shuffle(a){ for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}

function buildRound(){
  document.getElementById("roundLabel").innerText = `ROUND ${round}`;
  document.getElementById("roundCount").innerText = `Round ${round} of ${totalRounds}`;
  startTimer();
  shuffle(players);

  let div=document.getElementById("courts"); div.innerHTML="";
  let index=0, courts=Number(document.getElementById("courtsCount").value);

  for(let c=1;c<=courts;c++){
    let g=players.slice(index,index+4); if(g.length<4) break; index+=4;
    div.innerHTML+=`
      <div class="court">
      <h3 class="center">Court ${c}</h3>
      <div class="row"><div class="pill">${g[0]} & ${g[1]}</div><div class="pill">${g[2]} & ${g[3]}</div></div>
      <button onclick="win('${g[0]}','${g[1]}')">Team 1 Won</button>
      <button onclick="win('${g[2]}','${g[3]}')">Team 2 Won</button>
      </div>`;
  }

  if(players.length>index){
    div.innerHTML+=`<div class="court"><h3 class="center">ü™ë Sitting Out</h3><p class="center">${players.slice(index).join(", ")}</p></div>`;
  }
}

function win(a,b){ wins[a]++; wins[b]++; }

function startTimer(){
  clearInterval(timerInterval);
  let sec=document.getElementById("roundMinutes").value*60;
  timerInterval=setInterval(()=>{
    let m=Math.floor(sec/60), s=sec%60;
    document.getElementById("timer").innerText=`‚è± ${m}:${s.toString().padStart(2,"0")}`;
    if(sec--<=0){clearInterval(timerInterval);alert("Round over!");}
  },1000);
}

function nextRound(){
  if(round>=totalRounds){ endSession(); return; }
  round++; buildRound();
}

function endSession(){
  document.getElementById("game").style.display="none";
  document.getElementById("end").style.display="block";
  let board=Object.entries(wins).sort((a,b)=>b[1]-a[1]);
  document.getElementById("leaderboard").innerHTML =
    board.map((p,i)=>`${i+1}. ${p[0]} ‚Äî ${p[1]} wins`).join("<br>");
}

function reset(){ location.reload(); }
</script>

</body>
</html>
